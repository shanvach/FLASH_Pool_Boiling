
int globalGrid[LOW_IND:HIGH_IND,MDIM]
int localSize[MDIM]
int procGrid[MDIM], me[MDIM]
int Pfft_level
int dest(:)

procGrid=read()

me=getdirectionalmyPe(procGrid)

Pfft_level = getDesignatedPfftLevel()

globalGrid=getPfftGridConfiguration(Pfft_level)

localSize=getLocalPencilSize(globalGrid,procGrid)

for all blocks
  
  /* Assume there is a collection bin for each destionation found */
  /* A block may get mapped to more than one processor in the UG pencil */
  dest=findDestinationProcessor(procGrid,localSize,block_cornerID)

  if(refLevel(block)<Pfft_level)
    put_copyOfBlockinEachBin(dest,refLevel(block),section)
  else
    if(refLevel(block)>Pfft_level)
      restrict_blockToPfftLevel
    endif
    put_appropriateSectionOfBlockInBin(dest,refLevel(block))
  end if
end for 
  
exchange_bins_between_processors
  
for each received block
  level = getBlockRefLevel
  if(level<Pfft_level)
    prolong_appropriate_section_of_block(section)
  end if
  put_data_in_right_place
end for

    